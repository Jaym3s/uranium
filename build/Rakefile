task :default => [:compile]

task :install_compiler do
  installed = true

  puts "-"*40
  puts "Checking for Google Closure Compiler"
  puts "-"*40

  begin
    File.open("./compiler/compiler.jar")
  rescue Errno::ENOENT => e
    puts "Google Closure Compiler not installed locally ... installing now..."
    installed = false
  end

  if installed
    puts "... found"
  else
    sh "mkdir compiler"
    sh "curl -s http://closure-compiler.googlecode.com/files/compiler-latest.zip > ./compiler/compiler-latest.zip"
    sh "unzip ./compiler/compiler-latest.zip -d compiler"
    puts "... done"
  end
end

task :compile => [:install_compiler]
# TODO: Add a test_compiler task


# TODO: Add the commit hash as a comment to the compiled file so that we have some version tracking?
task :compile do
  puts "-"*40
  puts "Compiling widgets"
  puts "-"*40

  ["webkit", "bb", "ie"].each do |flavor|
    puts "Compiling #{flavor} flavor ..."
    sh "ruby enrich.rb #{flavor}"
  end

  puts "... done"
end
